# 

## diff of answer kernel1

M=N=K=8:
error at 31: 41303.75,36563.16
[42620.79, 50159.39, 38617.85, 36957.04, 31598.75, 40499.96, 31575.00, 35244.22 ;
30190.54, 39793.10, 35212.03, 29429.24, 22892.80, 34752.31, 36519.42, 40236.75 ;
29812.96, 38812.77, 46537.17, 33107.25, 28581.54, 40283.28, 39831.42, 31928.36 ;
32832.37, 44158.31, 38329.57, 43777.81, 25342.95, **36563.16**, 42586.51, **41303.75** ;
27091.94, 35771.64, 32431.31, 33045.27, 24805.50, 24900.68, 30690.43, 32145.20 ;
24251.58, 24557.33, 32228.73, 24234.22, 20720.35, 26752.28, 37390.09, 28955.72 ;
31912.19, 41460.97, 47332.44, 41435.03, 27279.94, 27415.38, 54010.51, 40004.78 ;
35300.80, 37919.97, 42400.28, 40271.02, 26398.30, 33033.78, 50733.19, 46422.57 ]

[42620.79, 50159.39, 38617.85, 36957.04, 31598.75, 40499.96, 31575.00, 35244.22 ;
30190.54, 39793.10, 35212.03, 29429.24, 22892.80, 34752.31, 36519.42, 40236.75 ;
29812.96, 38812.77, 46537.17, 33107.25, 28581.54, 40283.28, 39831.42, 31928.36 ;
32832.37, 44158.31, 38329.57, 43777.81, 25342.95, **36563.16**, 42586.51, **36563.16** ;
27091.94, 35771.64, 32431.31, 33045.27, 24805.50, 24900.68, 30690.43, 32145.20 ;
24251.58, 24557.33, 32228.73, 24234.22, 20720.35, 26752.28, 37390.09, 28955.72 ;
31912.19, 41460.97, 47332.44, 41435.03, 27279.94, 27415.38, 54010.51, 40004.78 ;
35300.80, 37919.97, 42400.28, 40271.02, 26398.30, **33033.78**, **33033.78**, **33033.78** ]

The last element of 4th line is a duplicate of previous one. And the last three elements of line 8 is also same as each other.
This cannot be broblem of calculation. It should be memory copy/access related error.
 

 M=N=K=10:
error at 37: 70681.13,46039.21
[51430.26, 37538.26, 54316.81, 76458.19, 66670.65, 46685.51, 45382.99, 77642.29, 44331.81, 57984.50 ;
59670.73, 51677.89, 49539.03, 58643.09, 45020.80, 47533.31, 51402.28, 75703.18, 46363.05, 46426.65 ;
49489.82, 44318.28, 36240.14, 47846.19, 45541.06, 37721.15, 42349.02, 61324.03, 50468.00, 53979.89 ;
51349.28, 46941.73, 40959.78, 53309.31, 52974.83, **46039.21**, 46616.42, **70681.13**, 49143.42, 54170.78 ;
63172.69, 49281.33, 64720.90, 79909.98, 72943.91, 55134.52, 70847.62, 93319.46, 72098.09, 61974.57 ;
50122.12, 31180.34, 46241.94, 59842.17, 50775.06, 40968.30, 43713.15, 62614.97, 47673.76, 45537.47 ;
34690.48, 32100.15, 35274.06, 54992.78, 40212.61, 33720.47, 42347.37, 60751.20, 46650.87, 48834.29 ;
45890.37, 39684.31, 46750.24, 64754.47, 55623.83, 42431.96, 50387.11, 74083.19, 49677.53, 56993.20 ;
83113.78, 71588.01, 76992.48, 96107.42, 92105.73, 73463.50, 89830.30, 121644.43, 82865.35, 81416.24 ;
54505.34, 42698.54, 54443.14, 71820.66, 57223.91, 57131.34, 63402.56, 87269.93, 58538.53, 55082.54 ]
[51430.26, 37538.26, 54316.81, 76458.19, 66670.65, 46685.51, 45382.99, 77642.29, 44331.81, 57984.50 ;
59670.73, 51677.89, 49539.03, 58643.09, 45020.80, 47533.31, 51402.28, 75703.18, 46363.05, 46426.65 ;
49489.82, 44318.28, 36240.14, 47846.19, 45541.06, 37721.15, 42349.02, 61324.03, 50468.00, 53979.89 ;
51349.28, 46941.73, 40959.78, 53309.31, 52974.83, **46039.21**, 46616.42, **46039.21**, 49143.42, 54170.78 ;
63172.69, 49281.33, 64720.90, 79909.98, 72943.91, 55134.52, 70847.62, 93319.46, 72098.09, 61974.57 ;
50122.12, 31180.34, 46241.94, 59842.17, 50775.06, 40968.30, 43713.15, 62614.97, 47673.76, 45537.47 ;
34690.48, 32100.15, 35274.06, 54992.78, 40212.61, 33720.47, 42347.37, 60751.20, 46650.87, 48834.29 ;
45890.37, 39684.30, 46750.24, 64754.47, 55623.83, **42431.96**, **42431.96**, **42431.96**, 49677.53, 56993.20 ;
 0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00, 82865.35, 81416.24 ;
 0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00,  0.00, 58538.53, 55082.54 ]

We can see the same pattern happens at a different place, with some elements been set to zeros.
Because I forgot to add break to switch case, so the right answer was overwritten by later execution.

kernel4
M=N=K=10:
error at 10: 63965.83,135398.71
[43807.41, 54548.72, 65392.50, 42431.92, 53948.37, 54356.34, 36900.04, 49303.07, 45849.09, 52696.85 ;
**63965.83**, 78722.35, 78735.79, 48984.45, 79810.05, 78486.15, 59394.33, 58293.88, 60379.94, 69932.09 ;
44465.58, 54486.74, 51494.15, 32970.95, 54486.46, 60426.45, 39619.37, 50719.21, 42375.12, 52065.87 ;
57557.05, 51956.87, 52954.46, 41027.91, 53003.92, 75683.00, 44285.59, 44976.73, 42614.01, 48726.51 ;
58547.78, 67936.86, 66477.21, 43312.50, 51069.60, 65164.10, 44413.89, 50359.25, 48774.70, 62538.04 ;
64144.24, 64469.41, 60957.17, 43966.75, 59031.21, 72095.76, 55968.92, 41888.23, 44422.30, 52412.32 ;
47655.17, 66816.82, 55618.16, 36342.75, 47137.70, 52220.98, 46199.83, 49964.60, 39694.16, 51180.38 ;
53946.10, 71819.65, 74714.38, 43542.62, 60737.92, 62474.01, 47976.83, 50153.80, 55593.19, 66312.23 ;
42587.96, 44523.00, 52519.62, 43060.83, 50272.80, 62756.60, 44585.56, 39100.17, 42586.92, 35283.28 ;
43661.90, 51058.72, 52183.70, 30192.82, 52298.56, 59088.05, 30937.89, 46961.82, 51772.35, 62804.84 ]
[43807.41, 54548.72, 65392.50, 42431.92, 53948.37, 54356.34, 36900.04, 49303.07, 45849.09, 52696.85 ;
135398.71, 138125.34, 78735.79, 48984.45, 79810.05, 78486.15, 59394.33, 58293.88, 60379.94, 69932.09 ;
119700.29, 129441.50, 51494.15, 32970.95, 54486.46, 60426.45, 39619.37, 50719.21, 42375.12, 52065.87 ;
110075.66, 107968.02, 52954.46, 41027.91, 53003.92, 75683.00, 44285.59, 44976.73, 42614.01, 48726.51 ;
107147.76, 121555.87, 66477.21, 43312.50, 51069.60, 65164.10, 44413.89, 50359.25, 48774.70, 62538.04 ;
128570.29, 123691.99, 60957.17, 43966.75, 59031.21, 72095.76, 55968.92, 41888.23, 44422.30, 52412.32 ;
102565.15, 133691.70, 55618.16, 36342.75, 47137.70, 52220.98, 46199.83, 49964.60, 39694.16, 51180.38 ;
105625.11, 126232.67, 74714.38, 43542.62, 60737.92, 62474.01, 47976.83, 50153.80, 55593.19, 66312.23 ;
115672.78, 110676.55, 52519.62, 43060.83, 50272.80, 62756.60, 44585.56, 39100.17, 42586.92, 35283.28 ;
95946.13, 105099.23, 52183.70, 30192.82, 52298.56, 59088.05, 30937.89, 46961.82, 51772.35, 62804.84 ]


kernel5
M=N=K=10:
error at 76: 50758.94,32251.04
[51324.48, 60454.96, 61589.82, 74540.75, 73494.95, 46285.56, 60239.57, 65842.17, 49873.95, 102781.87 ;
34787.47, 55592.40, 50338.61, 49618.41, 52498.36, 36294.94, 43668.91, 50231.74, 35139.72, 64714.00 ;
27734.73, 38537.98, 35054.02, 46978.01, 39407.18, 25623.47, 27217.32, 36937.67, 24446.86, 46731.92 ;
52425.53, 40836.33, 44526.52, 59183.86, 63275.89, 35065.54, 41316.15, 57606.23, 34257.75, 70148.34 ;
35493.37, 38312.40, 42117.38, 54910.74, 43490.96, 29297.62, 40994.51, 52337.00, 34556.17, 71664.29 ;
47807.97, 53980.50, 58602.69, 72793.41, 68841.80, 40583.69, 44824.60, 65396.14, 50341.36, 83281.25 ;
35810.98, 43899.00, 50086.29, 80105.79, 50294.42, 33044.19, 52783.19, 52520.01, 52610.10, 88032.00 ;
45392.65, 48527.29, 56117.29, 62788.96, 64421.29, **32251.04**, **50758.94**, 60596.00, 40577.98, 79769.70 ;
33483.03, 36762.74, 50575.07, 60101.24, 45748.25, 36083.00, 35313.69, 51461.08, 32331.13, 69446.31 ;
38285.69, 48329.08, 53730.97, 60919.85, 57575.50, 44524.88, 47129.84, 45764.96, 27138.78, 73859.95 ]
[51324.48, 60454.96, 61589.82, 74540.75, 73494.95, 46285.56, 60239.57, 65842.17, 49873.95, 102781.87 ;
34787.47, 55592.40, 50338.61, 49618.41, 52498.36, 36294.94, 43668.91, 50231.74, 35139.72, 64714.00 ;
27734.73, 38537.98, 35054.02, 46978.01, 39407.18, 25623.47, 27217.32, 36937.67, 24446.86, 46731.92 ;
52425.53, 40836.33, 44526.52, 59183.86, 63275.89, 35065.54, 41316.15, 57606.23, 34257.75, 70148.34 ;
35493.37, 38312.40, 42117.38, 54910.74, 43490.96, 29297.62, 40994.51, 52337.00, 34556.17, 71664.29 ;
47807.97, 53980.50, 58602.69, 72793.41, 68841.80, 40583.69, 44824.60, 65396.14, 50341.36, 83281.25 ;
35810.98, 43899.00, 50086.29, 80105.79, 50294.42, 33044.19, 52783.19, 52520.01, 52610.10, 88032.00 ;
45392.65, 48527.29, 56117.29, 62788.96, 64421.29, **32251.04**, **32251.04**, **32251.04**, 40577.98, 79769.70 ;
33483.03, 36762.74, 50575.07, 60101.24, 45748.25, 36083.00, 35313.69, 51461.08, 32331.13, 69446.31 ;
38285.69, 48329.08, 53730.97, 60919.85, 57575.50, 44524.88, 47129.84, 45764.96, 27138.78, 73859.95 ]



M=N=K=12:
error at 90: 42667.34, 50467.98
[36261.05, 41945.77, 61175.01, 57226.76, 50921.51, 63225.88, 40371.16, 58168.47, 49334.81, 40892.42, 39812.30, 63635.42 ;
44441.17, 59384.60, 76595.91, 59642.03, 59601.95, 72297.20, 48006.49, 65043.96, 72936.87, 58317.50, 59117.26, 62445.68 ;
38202.23, 54734.98, 71840.56, 49170.71, 44794.69, 41259.22, 46028.45, 50513.93, 61800.49, 52655.51, 53463.64, 53273.06 ;
52993.78, 71204.25, 94089.89, 73075.55, 72430.12, 74139.77, 57857.85, 81294.76, 77603.15, 64065.87, 57310.25, 76770.48 ;
25841.41, 39385.15, 54150.90, 34010.98, 40131.38, 33315.35, 32138.49, 36601.73, 40713.43, 43180.86, 39707.69, 34439.78 ;
32249.93, 47008.60, 59974.21, 45672.26, 40351.82, 44251.34, 35322.00, 54190.18, 51341.07, 49838.67, 46818.05, 51806.82 ;
40460.77, 37996.28, 52669.69, 41065.47, 59045.51, 49597.48, 57706.87, 53983.77, 47268.74, 44366.74, 40600.97, 44759.90 ;
40655.25, 40399.82, 60857.79, 53917.06, 49652.69, **50467.98**, **42667.34**, 56339.25, 48066.03, 43703.44, 36208.73, 53815.28 ;
47470.58, 62615.26, 87290.24, 64984.14, 72887.54, 74250.46, 59119.56, 69370.61, 77425.90, 69215.55, 66595.13, 66374.84 ;
42216.12, 55823.04, 77521.28, 56254.53, 60536.03, 62260.89, 51209.45, 60863.43, 69058.64, 64756.16, 63376.57, 61295.98 ;
49909.61, 62123.30, 72701.79, 57512.52, 58334.94, 64789.51, 47808.43, 75234.66, 69291.23, 57041.34, 56467.74, 59298.27 ;
44932.45, 66135.72, 102290.12, 68540.93, 86286.83, 80600.01, 65451.32, 88518.86, 83743.39, 63920.50, 55062.81, 78384.91 ]
[36261.05, 41945.77, 61175.01, 57226.76, 50921.51, 63225.88, 40371.16, 58168.47, 49334.81, 40892.42, 39812.30, 63635.42 ;
44441.17, 59384.60, 76595.91, 59642.03, 59601.95, 72297.20, 48006.49, 65043.96, 72936.87, 58317.50, 59117.26, 62445.68 ;
38202.23, 54734.98, 71840.56, 49170.71, 44794.69, 41259.22, 46028.45, 50513.93, 61800.49, 52655.51, 53463.64, 53273.06 ;
52993.78, 71204.25, 94089.89, 73075.55, 72430.12, 74139.77, 57857.85, 81294.76, 77603.15, 64065.87, 57310.25, 76770.48 ;
25841.41, 39385.15, 54150.90, 34010.98, 40131.38, 33315.35, 32138.49, 36601.73, 40713.43, 43180.86, 39707.69, 34439.78 ;
32249.93, 47008.60, 59974.21, 45672.26, 40351.82, 44251.34, 35322.00, 54190.18, 51341.07, 49838.67, 46818.05, 51806.82 ;
40460.77, 37996.28, 52669.69, 41065.47, 59045.51, 49597.48, 57706.87, 53983.77, 47268.74, 44366.74, 40600.97, 44759.90 ;
40655.25, 40399.82, 60857.79, 53917.06, 49652.69, **50467.98**, **50467.98**, **50467.98**, 48066.03, 43703.44, 36208.73, 53815.28 ;
47470.58, 62615.26, 87290.24, 64984.14, 72887.54, 74250.46, 59119.56, 69370.61, 77425.90, 69215.55, 66595.13, 66374.84 ;
42216.12, 55823.04, 77521.28, 56254.53, 60536.03, 62260.89, 51209.45, 60863.43, 69058.64, 64756.16, 63376.57, 61295.98 ;
49909.61, 62123.30, 72701.79, 57512.52, 58334.94, 64789.51, 47808.43, 75234.66, 69291.23, 57041.34, 56467.74, 59298.27 ;
44932.45, 66135.72, 102290.12, 68540.93, 86286.83, 80600.01, 65451.32, 88518.86, 83743.39, 63920.50, 55062.81, 78384.91 ]


- ‘asm’ operand has impossible constraints

Using the "r" constraint forces the compiler to load the parameter into a scratch register before using that scratch register for one of your mov instructions. There simply aren't 4 scratch registers available.

Use the "g" constraint instead. This is more effiecient anyway, since the compiler will be able to access the argument directly in your mov instructions using a frame pointer offsetted memory access onto the destination register instead of doing that into a scratch register then moving the scratch register into the ultimate destination.


- invalid 'asm': operand number missing after %-letter
very common when write registers with one %


- error: scale factor in address must be 1, 2, 4 or 8
somtimes sompiler do not recognize all the errors , like this.

"vmovupd (%2, %8, 0x10), %%zmm2;"// load c_ptr+(2)*LDC



- expecting `)' after scale factor in `(%rax,8(%rsp),8)'

because address expression or scale/index/base operand has the form displacement(base, index, scale) where displacement is a constant or symbol, base and index are registers, and scale is 1, 2, 4, or 8. 
and 8(%rsp) is invalid for the index operand.

However, this expression is written initially as (%%rax, %8, 8). %8 was replaced by 8(%rsp)
My solution is explicitly point out the register in address expression.


- Error: register value used as expression

"vbroadcastsd (%9), %%zmm16;" might be a problem


- segmentation fault in kernel8
LOOP_J:
...
"vmovupd (%%rbx, %%r8, 8), %%zmm1;"

because %rbx=%rax+%rsi*8, but %rsi=0x900000009, not 0x9 as supposed.
So why "movq %6, %%rsi;" didn't clean the high bit of rsi


- operand type mismatch for 'vaddpd'/'vbroadcastsd'

in vector instructions, the operand can be memory location. But it need to be in pair of () 

and for 


- the results of calculation in asm are wrong.

no "\_\_volatile__", the results are all 0.


-  kernel10

M=N=K=9:
error at 80: 43291.44,86582.88
[37269.50, 34984.72, 54012.74, 54993.62, 67951.79, 68669.50, 42759.31, 38669.34, 55370.86 ;
43709.48, 26585.23, 54064.05, 54872.50, 65097.68, 60303.47, 57584.30, 39040.38, 56586.96 ;
51336.37, 48156.38, 70126.87, 69745.07, 90372.01, 81073.43, 60724.81, 51212.91, 73604.83 ;
46169.27, 47178.71, 62824.76, 56678.72, 79802.00, 71475.92, 51439.18, 37808.87, 65479.51 ;
47874.37, 36443.32, 55051.86, 54039.17, 66747.98, 54626.00, 61847.17, 32893.41, 59509.57 ;
58585.27, 42131.16, 66083.64, 65875.94, 85239.94, 73531.25, 67252.30, 45406.64, 66562.77 ;
39603.38, 38602.31, 56160.23, 59686.39, 83804.02, 64967.13, 62019.34, 46694.01, 72844.60 ;
33024.93, 37398.24, 50143.80, 43540.50, 55249.83, 53592.38, 33667.13, 23820.28, 42142.15 ;
32620.28, 38625.62, 47900.59, 44961.80, 57599.63, 51201.75, 46135.79, 28558.19, **43291.44** ]
[37269.50, 34984.72, 54012.74, 54993.62, 67951.79, 68669.50, 42759.31, 38669.34, 55370.86 ;
43709.48, 26585.23, 54064.05, 54872.50, 65097.68, 60303.47, 57584.30, 39040.38, 56586.96 ;
51336.37, 48156.38, 70126.87, 69745.07, 90372.01, 81073.43, 60724.81, 51212.91, 73604.83 ;
46169.27, 47178.71, 62824.76, 56678.72, 79802.00, 71475.92, 51439.18, 37808.87, 65479.51 ;
47874.37, 36443.32, 55051.86, 54039.17, 66747.98, 54626.00, 61847.17, 32893.41, 59509.57 ;
58585.27, 42131.16, 66083.64, 65875.94, 85239.94, 73531.25, 67252.30, 45406.64, 66562.77 ;
39603.38, 38602.31, 56160.23, 59686.39, 83804.02, 64967.13, 62019.34, 46694.01, 72844.60 ;
33024.93, 37398.24, 50143.80, 43540.50, 55249.83, 53592.38, 33667.13, 23820.28, 42142.15 ;
32620.28, 38625.62, 47900.59, 44961.80, 57599.63, 51201.75, 46135.79, 28558.19, **86582.88** ]

